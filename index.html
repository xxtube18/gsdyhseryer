<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Multi-Stream Hub Pro</title>
    <style>
        :root { --bg: #0a0a0c; --panel: #18181b; --accent: #00d1ff; --save: #00ff88; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding: 15px; }
        
        .header {
            background: var(--panel);
            padding: 15px;
            border-radius: 8px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            border: 1px solid #333;
        }
        input { flex-grow: 1; padding: 12px; border-radius: 4px; border: 1px solid #444; background: #000; color: white; min-width: 250px; }
        
        button { padding: 12px 15px; border-radius: 4px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-add { background: var(--accent); color: #000; }
        .btn-share { background: var(--save); color: #000; }
        .btn-clear { background: #ff4444; color: white; }

        .stream-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 15px;
        }
        .video-container {
            position: relative;
            background: #000;
            aspect-ratio: 16 / 9;
            border: 2px solid #2f2f35;
            border-radius: 6px;
            overflow: hidden;
        }
        iframe { width: 100%; height: 100%; border: none; }
        .remove-btn { position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; border: 1px solid #444; padding: 5px; cursor: pointer; z-index: 10; }

        #shareLinkDisplay {
            margin-top: 10px;
            padding: 10px;
            background: #222;
            border-radius: 4px;
            display: none;
            width: 100%;
            word-break: break-all;
            color: var(--save);
            font-size: 12px;
        }
    </style>
</head>
<body>

<div class="header">
    <input type="text" id="streamUrl" placeholder="Cole o link (YouTube, Twitch ou Kick)">
    <button class="btn-add" onclick="addNewStream()">+ Adicionar</button>
    <button class="btn-share" onclick="generateShareLink()">ðŸ”— Gerar Link para Compartilhar</button>
    <button class="btn-clear" onclick="clearAll()">Limpar Tudo</button>
    <div id="shareLinkDisplay"></div>
</div>

<div class="stream-grid" id="grid"></div>

<script>
    let activeStreams = [];

    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        const sharedData = urlParams.get('config');

        if (sharedData) {
            try {
                // Carrega configuraÃ§Ã£o do link compartilhado
                const decoded = JSON.parse(atob(sharedData));
                activeStreams = decoded;
                activeStreams.forEach(url => renderStream(url));
            } catch(e) { 
                console.error("Erro no link compartilhado");
                loadFromLocal();
            }
        } else {
            loadFromLocal();
        }
    };

    function loadFromLocal() {
        activeStreams = JSON.parse(localStorage.getItem('myStreams')) || [];
        activeStreams.forEach(url => renderStream(url));
    }

    function addNewStream() {
        const input = document.getElementById('streamUrl');
        const url = input.value.trim();
        if (url) {
            activeStreams.push(url);
            renderStream(url);
            saveToLocal();
            input.value = "";
        }
    }

    function renderStream(url) {
        let embedUrl = "";
        const domain = window.location.hostname || "localhost";

        if (url.includes("twitch.tv")) {
            const channel = url.split('/').filter(Boolean).pop();
            embedUrl = `https://player.twitch.tv/?channel=${channel}&parent=${domain}`;
        } else if (url.includes("youtube.com") || url.includes("youtu.be")) {
            let id = url.includes("v=") ? url.split("v=")[1].split("&")[0] : url.split("/").pop();
            embedUrl = `https://www.youtube-nocookie.com/embed/${id}?autoplay=1`;
        } else if (url.includes("kick.com")) {
            // CorreÃ§Ã£o para o link do Kick
            const user = url.split('/').filter(Boolean).pop();
            embedUrl = `https://player.kick.com/${user}`;
        }

        if (embedUrl) {
            const div = document.createElement('div');
            div.className = 'video-container';
            div.innerHTML = `
                <button class="remove-btn" onclick="removeStream('${url}', this)">X</button>
                <iframe src="${embedUrl}" allowfullscreen></iframe>
            `;
            document.getElementById('grid').appendChild(div);
        } else {
            alert("Link nÃ£o suportado!");
        }
    }

    function generateShareLink() {
        if (activeStreams.length === 0) return alert("Adicione lives primeiro!");
        
        // Codifica a lista de streams para a URL
        const encoded = btoa(JSON.stringify(activeStreams));
        const shareUrl = window.location.origin + window.location.pathname + "?config=" + encoded;
        
        const display = document.getElementById('shareLinkDisplay');
        display.style.display = "block";
        display.innerText = "LINK GERADO (Copie e envie): " + shareUrl;
        
        navigator.clipboard.writeText(shareUrl);
        alert("Link de compartilhamento copiado!");
    }

    function saveToLocal() {
        localStorage.setItem('myStreams', JSON.stringify(activeStreams));
    }

    function removeStream(url, btn) {
        activeStreams = activeStreams.filter(u => u !== url);
        saveToLocal();
        btn.parentElement.remove();
    }

    function clearAll() {
        if(confirm("Remover todas as telas?")) {
            activeStreams = [];
            saveToLocal();
            document.getElementById('grid').innerHTML = "";
            window.history.pushState({}, document.title, window.location.pathname);
            document.getElementById('shareLinkDisplay').style.display = "none";
        }
    }
</script>
</body>
</html>
